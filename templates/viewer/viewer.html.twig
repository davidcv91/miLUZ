{% extends "base.html.twig" %}

{% block title %}{{ parent() }}View all data{% endblock %}

{% block body %}
    <h1>Chart</h1>
    <canvas id="myChart"></canvas>
    <hr/>
    <h1>Horizontal Table</h1>
    <table>
        <thead>
        <tr>
            <th>Date</th>
            {% for hour in 0..23 %}
            <th>{{ '%02d'|format(hour) }}h - {{ '%02d'|format(hour+1) }}h</th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for date, dayConsumptions in consumptions %}
            <tr>
                <td>{{ date }}</td>
                {% for consumption in dayConsumptions %}
                <td>{{ consumption.consumption }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <hr/>
    <h1>Vertical Table</h1>
    <table>
        <thead>
        <tr>
            <th>Hour</th>
            {% for date in consumptions|keys %}
            <th>{{ date }}</th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for hour in 0..23 %}
            <tr>
                <td>{{ '%02d'|format(hour) }}h - {{ '%02d'|format(hour+1) }}h</td>
            {% for date, dateConsumptions in consumptions %}
                {% if dateConsumptions[hour] is defined %}
                    <td>{{ dateConsumptions[hour].consumption }}</td>
                {% else %}
                    <td></td>
                {% endif %}
            {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/Chart.bundle.min.js') }}"></script>
    <script>
        var chart_data = {'labels': [], 'data': []};
        {% for date, dayConsumptions in consumptions %}
        chart_data.labels.push("{{ date }}");
            {% set sumConsumption = 0 %}
            {% for consumption in dayConsumptions %}
                {% set sumConsumption = sumConsumption+consumption.consumption %}
            {% endfor %}

            chart_data.data.push({{ (sumConsumption/1000)|number_format(1, '.', ',') }});
        {% endfor %}

        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            // The type of chart we want to create
            type: 'bar',

            // The data for our dataset
            data: {
                labels: chart_data['labels'],
                datasets: [{
                    label: "Day consumption",
                    backgroundColor: '#248eff',
                    borderColor: '#248eff',
                    data: chart_data['data'],
                }]
            },

            // Configuration options go here
            options: {}
        });
    </script>
{% endblock %}